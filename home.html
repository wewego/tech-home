<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="styles/home.css" />

    <title>Home</title>
  </head>

  <body>
    <!-- Navbar -->
    <nav
      class="navbar navbar-expand-lg navbar-light bg-light"
      style="height: 90px"
    >
      <a class="navbar-brand" href="#"
        ><img
          width="120px"
          height="80px"
          src="assets/The Tech Home-logos_transparent.png"
          alt="Logo"
      /></a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div
        class="collapse navbar-collapse nav-med"
        style="background: #f8f9fa; padding-left: 15px"
        id="navbarSupportedContent"
      >
        <ul class="navbar-nav mr-auto">
          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              id="navbarDropdown"
              role="button"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
             
            >
              Catagories
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown" id="container-div">
              
              
            </div>
          </li>
        </ul>
        <form id="search-form" onSubmit="return false;">
          <input
            class="form-control mr-sm-2"
            placeholder="Search"
            aria-label="Search"
            id="search-input"
          />
        </form>
        <ul class="navbar-nav">
          <li class="nav-item" id="my-account">
            <a class="nav-link" href="#"
              ><img
                width="30px"
                src="assets/account-circle-svgrepo-com.svg"
                alt="account logo"
              />
              My Account</a
            >
          </li>
          <li class="nav-item" id="cart">
            <a class="nav-link" href="#"
              ><img
                width="30px"
                src="assets/cart-svgrepo-com.svg"
                alt="cart icon"
              />
              Cart</a
            >
          </li>
        </ul>
      </div>
    </nav>
    <!-- Product collections -->
    <section id="container-section">
    </section>

    <!-- Footer -->
    <footer>
      <ul class="footer">
        <li>
          <div>
            <img
              width="20%"
              src="assets/The Tech Home-logos_white.png"
              alt="logo"
            />

            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. At libero
              excepturi explicabo totam et perspiciatis eaque officiis nemo
              consequatur, quo voluptate adipisci reprehenderit dolorem sunt
              error doloribus? Incidunt, quae reiciendis!
            </p>
          </div>
        </li>
        <li>
          <ul class="pages">
            <li>Home</li>
            <li>Catagories</li>
            <li>About Us</li>
          </ul>
        </li>
        <li>
          <p>Get in touch</p>
          <small>Feedback or questions?</small>
          <ul class="social">
            <li>
              <img src="assets/facebook-svgrepo-com.svg" alt="facebook" />
            </li>
            <li>
              <img src="assets/twitter-svgrepo-com.svg" alt="twiiter" />
            </li>
            <li>
              <img src="assets/youtube-svgrepo-com.svg" alt="youtube" />
            </li>
            <li>
              <img src="assets/instagram-svgrepo-com.svg" alt="instagram" />
            </li>
          </ul>
        </li>
      </ul>
    </footer>
    <div class="container"></div>
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
      if (getCookie("search") != ""){
        var searchInput = getCookie("search");
    $.ajax({
              type: 'GET',
    
  url: 'http://ec2-44-208-82-216.compute-1.amazonaws.com/api/searchproduct/' + searchInput,
  success: function (data, status, xhr) {
    $("#container-section").empty();
    for (var i = 0; i < data.length; i++){
      if (i == 0){
         var imageUrl = "http://ec2-44-208-82-216.compute-1.amazonaws.com/storage/" + data[i].productImageURL
         $('#container-section').append('<div class="collections-item"><div class="products"><div class="product-item" onclick="productdetails('+data[i].id+')"><img src="'+imageUrl+'" /><p>'+data[i].productName+'</p><p>'+data[i].productPrice+'</p></div>');
      }
      else{
        var imageUrl = "http://ec2-44-208-82-216.compute-1.amazonaws.com/storage/" + data[i].productImageURL
                            $('.products').append('<div class="product-item" onclick="productdetails('+data[i].id+')"><img src="'+imageUrl+'" /><p>'+data[i].productName+'</p><p>'+data[i].productPrice+'</p></div>');
      }
    }
    $("#search-input").attr("value" , searchInput);


    
    
  }
});
    document.cookie = "search=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
    $('#my-account').click(function(){


  top.location.href="my-account.html";


});
$('#cart').click(function(){
top.location.href="cart.html";
});
$('#navbarDropdown').click(function(){
   $.ajax({
              type: 'GET',
    
  url: 'http://ec2-44-208-82-216.compute-1.amazonaws.com/api/category/',
  success: function (data, status, xhr) {
    var html = ''
    for (var i = 0; i<data.length; i++){
      document.cookie = "product_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      setCookie("category" , data[i].id);
      var cat = JSON.stringify(data[i].categoryName);
      cat = cat.replace(/^"(.*)"$/, '$1');
      html = html + ' <a class="dropdown-item" href="categories.html">' + cat + '</a>'
      

    }
    $('#container-div').html(html);
  }
});

         });
$("#search-form").keypress(function(e){
  
  if (e.keyCode == 13 && searchInput != ""){
    var searchInput = $("#search-input").val();
    $.ajax({
              type: 'GET',
    
  url: 'http://ec2-44-208-82-216.compute-1.amazonaws.com/api/searchproduct/' + searchInput,
  success: function (data, status, xhr) {
    $("#container-section").empty();
    for (var i = 0; i < data.length; i++){
      if (i == 0){
         var imageUrl = "http://ec2-44-208-82-216.compute-1.amazonaws.com/storage/" + data[i].productImageURL
         $('#container-section').append('<div class="collections-item"><div class="products"><div class="product-item" onclick="productdetails('+data[i].id+')"><img src="'+imageUrl+'" /><p>'+data[i].productName+'</p><p>'+data[i].productPrice+'</p></div>');
      }
      else{
        var imageUrl = "http://ec2-44-208-82-216.compute-1.amazonaws.com/storage/" + data[i].productImageURL
                            $('.products').append('<div class="product-item" onclick="productdetails('+data[i].id+')"><img src="'+imageUrl+'" /><p>'+data[i].productName+'</p><p>'+data[i].productPrice+'</p></div>');
      }
    }

    
    
  }

});

  }

   

});
thisFunctionDoesNotExistAndWasCreatedWithTheOnlyPurposeOfStopJavascriptExecutionOfAllTypesIncludingCatchAndAnyArbitraryWeirdScenario();



      }
      function getCookie(cname) {
    let name = cname + "=";
    let decodedCookie = decodeURIComponent(document.cookie);
    let ca = decodedCookie.split(';');
    for(let i = 0; i <ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }
  function setCookie(name,value,days) {
    var expires = "";
    if (days) {
      var date = new Date();
      date.setTime(date.getTime() + (days*24*60*60*1000));
      expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/";
  }

      function productdetails(product_id){
        document.cookie = "product_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        setCookie("product_id",product_id , 200);
        window.location.href = "product_details.html";

      }
      async function getproducts() {
    let url = 'http://ec2-44-208-82-216.compute-1.amazonaws.com/api/product/';
    try {
        let res = await fetch(url);
        return await res.json();
    } catch (error) {
        console.log(error);
    }
}

  async function renderproducts() {
    let products = await getproducts();
    var arrivalcounter = 0;
    var hotdealscounter = 0;
    var popularcounter = 0;
    products.forEach(product => {
                          var d = product.created_at;
                          const d_split = d.split("T");
                          let date_1 = new Date(d_split[0]);
                          let date_2 = new Date();
                          let difference =  date_2.getTime()-date_1.getTime();
                          let TotalDays = Math.ceil(difference / (1000 * 3600 * 24));
                          if (TotalDays <= 15 && arrivalcounter == 0){
                            var imageUrl = "http://ec2-44-208-82-216.compute-1.amazonaws.com/storage/" + product.productImageURL
                                 $('#container-section').append('<div class="collections-item"><h5>New arrivals</h5><div class="products"><div class="product-item" onclick="productdetails('+product.id+')"><img src="'+imageUrl+'" /><p>'+product.productName+'</p><p>'+product.productPrice+'</p></div>');
                                 arrivalcounter = arrivalcounter + 1;
                              

                          }

                          else if (TotalDays <= 15 && arrivalcounter == 0){

                            var imageUrl = "http://ec2-44-208-82-216.compute-1.amazonaws.com/storage/" + product.productImageURL
                            $('.products').append('<div class="product-item" onclick="productdetails('+product.id+')"><img src="'+imageUrl+'" /><p>'+product.productName+'</p><p>'+product.productPrice+'</p></div>');
                            
                            


                          }
                          
                          
                          

        
    });
 
                          products.forEach(product => {
                            if (product.productStock > 20 && popularcounter == 0){
                              var imageUrl = "http://ec2-44-208-82-216.compute-1.amazonaws.com/storage/" + product.productImageURL
                              $('#container-section').append('<div class="collections-item"><h5>Popular Products</h5><div class="products"><div class="product-item" onclick="productdetails('+product.id+')"><img src="'+imageUrl+'" /><p>'+product.productName+'</p><p>'+product.productPrice+'</p></div>');
                                 popularcounter = popularcounter + 1;
                             


                          }
                          else if (product.productStock > 20 && popularcounter == 1){
                            var imageUrl = "http://ec2-44-208-82-216.compute-1.amazonaws.com/storage/" + product.productImageURL
                            $('.products').append('<div class="product-item" onclick="productdetails('+product.id+')"><img src="'+imageUrl+'" /><p>'+product.productName+'</p><p>'+product.productPrice+'</p></div>');
                                 

                          }

                           });
                           products.forEach(product => {
                            if (product.productPrice < 500 && hotdealscounter == 0){
                              var imageUrl = "http://ec2-44-208-82-216.compute-1.amazonaws.com/storage/" + product.productImageURL
                              $('#container-section').append('<div class="collections-item"><h5>Hot deals</h5><div class="products"><div class="product-item" onclick="productdetails('+product.id+')"><img src="'+imageUrl+'" /><p>'+product.productName+'</p><p>'+product.productPrice+'</p></div>');
                                 hotdealscounter = hotdealscounter + 1;
                             


                          }
                          else if (product.productStock < 500 && hotdealscounter == 1){
                            var imageUrl = "http://ec2-44-208-82-216.compute-1.amazonaws.com/storage/" + product.productImageURL
                            $('.products').append('<div class="product-item" onclick="productdetails('+product.id+')"><img src="'+imageUrl+'" /><p>'+product.productName+'</p><p>'+product.productPrice+'</p></div>');
                                 

                          }

                           });

}

renderproducts();
$('#my-account').click(function(){


  top.location.href="my-account.html";


});
$('#cart').click(function(){
top.location.href="cart.html";
});
$('#navbarDropdown').click(function(){
   $.ajax({
              type: 'GET',
    
  url: 'http://ec2-44-208-82-216.compute-1.amazonaws.com/api/category/',
  success: function (data, status, xhr) {
    var html = ''
    for (var i = 0; i<data.length; i++){
      document.cookie = "product_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      setCookie("category" , data[i].id);
      var cat = JSON.stringify(data[i].categoryName);
      cat = cat.replace(/^"(.*)"$/, '$1');
      html = html + ' <a class="dropdown-item" href="categories.html">' + cat + '</a>'
      

    }
    $('#container-div').html(html);
  }
});

         });
$("#search-form").keypress(function(e){
  
  if (e.keyCode == 13 && searchInput != ""){
    var searchInput = $("#search-input").val();
    $.ajax({
              type: 'GET',
    
  url: 'http://ec2-44-208-82-216.compute-1.amazonaws.com/api/searchproduct/' + searchInput,
  success: function (data, status, xhr) {
    $("#container-section").empty();
    for (var i = 0; i < data.length; i++){
      if (i == 0){
         var imageUrl = "http://ec2-44-208-82-216.compute-1.amazonaws.com/storage/" + data[i].productImageURL
         $('#container-section').append('<div class="collections-item"><div class="products"><div class="product-item" onclick="productdetails('+data[i].id+')"><img src="'+imageUrl+'" /><p>'+data[i].productName+'</p><p>'+data[i].productPrice+'</p></div>');
      }
      else{
        var imageUrl = "http://ec2-44-208-82-216.compute-1.amazonaws.com/storage/" + data[i].productImageURL
                            $('.products').append('<div class="product-item" onclick="productdetails('+data[i].id+')"><img src="'+imageUrl+'" /><p>'+data[i].productName+'</p><p>'+data[i].productPrice+'</p></div>');
      }
    }
    
    
  }
});

  }

   

});


  

    </script>
  </body>
</html>
