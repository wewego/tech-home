<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles/form.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <title>Sign up</title>
  <link
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous"
  />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.0/css/toastr.min.css" integrity="sha512-HPSfJxnyVYJb4v9afT3fXvs0mXvdg/C7eYxBl1EYS7uQHuCU/0lSGhaH9o23Tw8FofBiGQfFWzMYD9TqK8tv/g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.0/js/toastr.min.js" integrity="sha512-i5xofbBta9oP3xclkdj0jO68kXE1tPeN8Jf3rwzsbwNrpFVifjhklWi8zMOOUscuMQaCPyIXl0TMWFjGwBaJxw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
<div class="form-container">
  <form id="regForm">
    <div class="form-floating mb-2 form-control-sm">
      <h5 class="fw-bold form-title">Sign Up</h5>
    </div>
    <div class="tab">
      <div class="form-floating mb-3 form-control-sm">
        <input
                type="text"
                class="form-control"
                id="name"
                placeholder="Name"
        />
        <label for="floatingInput">Name</label>
      </div>

      <div class="form-floating mb-3 form-control-sm">
        <input
                type="email"
                class="form-control"
                id="email"
                placeholder="email"
        />
        <label for="floatingInput">email</label>
      </div>

      <div class="form-floating mb-3 form-control-sm">
        <input
                type="text"
                class="form-control"
                id="phoneNumber"
                placeholder="Phone Number"
        />
        <label for="floatingInput">Phone Number</label>
      </div>
      <div class="form-floating mb-3 form-control-sm">
        <input
                type="text"
                class="form-control"
                id="area"
                placeholder="Area"
        />
        <label for="floatingInput">Area</label>
        

      </div>
      <a class="ms-2" href="./sign_in.html">Already have an account?</a>
    </div>
    <div class="tab">
      <div class="form-floating mb-3 form-control-sm">
        <input
                type="text"
                class="form-control"
                id="city"
                placeholder="City"
        />
        <label for="floatingInput">City</label>
      </div>
      <div class="form-floating mb-3 form-control-sm">
        <input
                type="text"
                class="form-control"
                id="country"
                placeholder="Country"
        />
        <label for="floatingInput">Country</label>
      </div>
      <div class="form-floating mb-3 form-control-sm">
        <input
                type="password"
                class="form-control"
                id="password"
                placeholder="Password..."
        />
        <label for="floatingInput">Password</label>
      </div>
      <div class="form-floating mb-3 form-control-sm">
        <input
                type="password"
                class="form-control"
                id="floatingInput"
                placeholder="Confirm Password ..."
        />
        <label for="floatingInput">Confirm Password</label>
      </div>
    </div>

    <div class="d-grid gap-2 form-floating pt-3 form-control-sm">
      <button
              class="btn btn-submit"
              id="nextBtn"
              onclick="nextPrev(1)"
              type="button"
      >
        Next
      </button>
    </div>
    <div style="text-align: center; margin-top: 40px">
      <span class="step"></span>
      <span class="step"></span>
    </div>
  </form>
</div>

<script>
  function validateEmail(email) 
      {
          var re = /\S+@\S+\.\S+/;
          return re.test(email);
      }
   function validator(input,phoneFlag,zipFlag,emailFlag,name){
    if (phoneFlag == true){
          let isnum = /^\d+$/.test(input);
          if (!isnum){
            toastr.error("Invalid Phone number format")
            awugkwuegwkeurgowkeug()
            return false;

          }
         
          else if (input.length > 11 || input.length < 11){
            toastr.error("Phone number must be 11 number")
            awugkwuegwkeurgowkeug()
            return false

          }

        }
        else if (zipFlag == true){
          var zip = /^\d{5}$/;
          if(!(input.value.match(zip))){
          toastr.error("Invalid Zip number format")
          awugkwuegwkeurgowkeug()
          return false;

        }
        
    

        }
        
        if (input.length == 0){
          toastr.error(name + " can't be empty " )
          awugkwuegwkeurgowkeug()
          return false
        }
        else if (input.length < 4){
          toastr.error(name + " can't be less than 4" )
          awugkwuegwkeurgowkeug()
          return false

        }

        
return true;
      }
  var counter = 1;
  var currentTab = 0;
  showTab(currentTab);

  function showTab(n) {
    var x = document.getElementsByClassName('tab');
    if (x.length > n){
      x[n].style.display = 'block';
    }
    if (n == x.length - 1) {
      document.getElementById('nextBtn').innerHTML = 'Submit';
    } else {
      document.getElementById('nextBtn').innerHTML = 'Next';
    }
    fixStepIndicator(n);
  }




  function getCookie(cname) {
    let name = cname + "=";
    let decodedCookie = decodeURIComponent(document.cookie);
    let ca = decodedCookie.split(';');
    for(let i = 0; i <ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }
  function setCookie(name,value,days) {
    var expires = "";
    if (days) {
      var date = new Date();
      date.setTime(date.getTime() + (days*24*60*60*1000));
      expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/";
  }


  function nextPrev(n) {
    if (counter == 1){
      var name = document.getElementById('name').value;
      var email = document.getElementById('email').value;
      var phoneNumber = document.getElementById('phoneNumber').value;
      var area = document.getElementById('area').value;
      validator(name,false,false,false,"Name") 
      validator(phoneNumber,true,false,false,"Phone")  
      validator(area,false,false,false,"Area")
      validator(email,false,false,false,"Email")
      if (!validateEmail(email)){
        toastr.error('Email format is not valid')
        owureghwkouegf()
      }

      
      setCookie("name",name,200);
      setCookie("email",email,200);
      setCookie("phoneNumber",phoneNumber,200);
      setCookie("area",area,200);
      counter = counter + 1;

      
      
    }
    else if (counter == 2){
      var namedata = getCookie("name");
      var emaildata = getCookie("email");
      var phonenumberdata = getCookie("phoneNumber");
      var areadata = getCookie("area");
      var citydata = document.getElementById('city').value;
      var countrydata = document.getElementById('country').value;
      var passworddata = document.getElementById('password').value;
      validator(citydata,false,false,false,"City")
      validator(countrydata,false,false,false,"Country")
      validator(passworddata,false,false,false,"Password")
      var data = { name: namedata , email: emaildata , phonenumber:phonenumberdata , area:areadata , city:citydata , country:countrydata , password: passworddata };
      $("#regForm").hide();
      fetch('http://ec2-44-208-82-216.compute-1.amazonaws.com/api/auth/register', {
        method: 'POST', // or 'PUT'
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
              .then((response) => response.json())
              .then((data) => {
                if (data["message"] == "User Created Successfully"){
                  toastr.success('You have registered successfully.')
                  // alert("user created");
                  setTimeout(function (){
                    window.location.href = "sign_in.html";
                  }, 500)
                }

              })
              .catch((error) => {
                alert('Error');
                $("#regForm").show();
              });
    }


    var x = document.getElementsByClassName('tab');
    if (n == 1 && !validateForm()) return false;
    x[currentTab].style.display = 'none';
    currentTab = currentTab + n;


    showTab(currentTab);

  }



  function validateForm() {
    var x,
            y,
            i,
            valid = true;
    x = document.getElementsByClassName('tab');
    y = x[currentTab].getElementsByTagName('input');
    for (i = 0; i < y.length; i++) {
      if (y[i].value == '') {
        y[i].className += ' invalid';
        valid = false;
      }
    }
    if (valid) {
      document.getElementsByClassName('step')[currentTab].className +=
              ' finish';
    }
    return valid;
  }

  function fixStepIndicator(n) {
    var i,
            x = document.getElementsByClassName('step');
    for (i = 0; i < x.length; i++) {
      x[i].className = x[i].className.replace(' active', '');
    }
    if (x.length > n) {
      x[n].className += ' active';
    }
  }
</script>

<script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>


</body>
</html>
